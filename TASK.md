# Домашнее задание по логистике

### Задание

Менеджер пришел к вам с идеей: выключить все каналы DPX в RU из-за низкой скорости доставки. Он хочет понять какой станет стоимость логистики и каким будет распределение по каналам

Нужно:
1. подумать на что стоит смотреть менеджеру
2. подготовить исследование (ноутбук для менеджера)
3. написать итог по задаче, чтобы менеджер принял решение

Формат итогов:
1. **TLDR**
2. Детали расчета
3. Допущения расчета
4. Вопросы к менеджеру / к себе
5. Фан-факты (инсайды)

### Что уже сделано

Для этого вы запустили модель выбора канала  два раза:
1. с текущими каналами
2. с отключением DPX

Результаты каждого из запусков находятся в таблице `homework_data`.  Их можно отличить по колонке `_id.exp`
- `russia-12-25-baseline-v2` - запуск до изменений
- `russia-12-25-tariff-change-no-dpx-v4` - запуск с отключением каналов

Семпл взят на данных ноября из 3 млн пользователей, которые сделали 17 млн заказов, которые объединились в 4.6 млн посылок весом 3.5 млн кг

ChatGPT/python/sql/любая BI/… - всем можно пользоваться, никаких ограничений по инструментарию нет. Однако результаты исследования нужно передать в общедоступном формате: либо python-ноутбук, либо публично доступный дашборд

### Словарь
1. `Логистический канал` - способ доставки от склада до получателя. Например, DPX-CN-RU-RM-PS: логист DPX доставляет из Китая в РФ с трекингов уровня registred mail (есть чекпоинты о получение пользователем), после трекингов могут идти произвольные обозначения, в данном случае -PS. Существует множество каналов из CN-RU, они отличаются ценой, скоростью, уровнем недоставок, свойствами товаров, которые можно перевозить

2. `Модель выбора канала` - это API, куда аналитик на вход передает список пользователей, свойства каналов, цены и бизнес-ограничения, а на выход получает по заказную таблицу с решением о выбранном для посылки канале и метриках. Позволяет смотреть как и за сколько мы повезем посылку. Запускается модель на семпле пользователей (около 5к), так как посчитать на большом количестве данных долго

3. `Консолидация` - объединение логистических заказов одного пользователя в одну посылку. Происходит при попадании всех заказов от пользователя в зону консолидации на складе

4. `Физический вес` - существует три вида веса:
    - предсказание веса, используется для оценки стоимости в момент продажи
    - вес логистическиого заказа, измеряется при поступлении посылки на склад
    - вес посылки, это сумма весов логистических заказов плюс вес мешка в который упаковываются отдельные заказы

5. `Виды заказов` - существует три вида заказов:
    - на маркетплейсе мы продаем отдельные SKU - будем называть их айтемы, количество которых задается quantity
    - продавец (у нас множество разных продавцов) может объединить несколько item в один логистический заказ
    - на складе мы можем объединить несколько логистических заказов в одну посылку

### Схема таблицы `homework_data`

```
|-- _id: struct (nullable = true) структура с айди
|   |-- exp: string (nullable = true) - айди эксперимента
|   |-- o: string (nullable = true) - order_number, айди логистического заказа
|
|-- fm: struct (nullable = true) - finalMetrics, структура по метрикам после консолидации. Куда финально и какая поедет посылка и сколько мы за это заплатим партнерам
|   |-- ch: string (nullable = true) - channel, логистический канал, которым поедет посылка
|   |-- pid: string (nullable = true) - parcelId, айди посылки
|   |-- pw: double (nullable = true) - parcelWeight, вес консолидированной посылки в кг
|   |-- rev: struct (nullable = true) ß
|       |-- price: long (nullable = true) - стоимость логистики после консолидации, в микротугриках, надо делить на 1е6, чтобы получить просто тугрики
|   |-- st: string (nullable = true) - shippingType, тип доставки, влияет на отслеживаемость (RM/SRM/NRM)
|   |-- t: timestamp (nullable = true) - time, время приезда на склад
|   |-- w: double (nullable = true) - weight, вес логистического заказа при поступлении на склад
|
|-- im: struct (nullable = true) - initialMetrics, структура по метрикам до консолидации. Куда изначально и какую мы планировали отправить посылку и сколько мы взяли с пользователя, когда создавался заказ
|   |-- ch: string (nullable = true) - логистический канал, выбранный при продаже
|   |-- pid: string (nullable = true) - айди посылки при создании заказа
|   |-- rev: struct (nullable = true)
|       |-- price: long (nullable = true) - стоимость логистики при создании заказа в микротугриках, надо делить на 1е6, чтобы получить просто тугрики
|   |-- st: string (nullable = true) - тип доставки, влияет на отслеживаемость (RM/SRM/NRM) при создании заказа
|   |-- t: timestamp (nullable = true) - время создания логистического заказа в кг
|   |-- w: double (nullable = true) - предсказанный вес логистического заказа в кг
|
|-- its: array (nullable = true) - items, структура про айтемы в логистическом заказе
|   |-- element: struct (containsNull = true)
|       |-- dangerousKinds: array (nullable = true)
|           |-- element: integer (containsNull = true) - типы опасности товара
|       |-- qty: integer (nullable = true) - quantity, количество товара одного SKU
|       |-- externalId: string (nullable = true) - айди SKU
|       |-- uw: double (nullable = true) - unitWeight, предсказанный физический вес товара при продаже в кг
|
|-- rcv: struct (nullable = true) - receiver, данные по пользователю о доставке
|   |-- city: string (nullable = true) - город доставки
|   |-- countryCode: string (nullable = true) - страна доставки
|   |-- id: string (nullable = true) - айди пользователя
|   |-- zipCode: string (nullable = true) - зип код пользователя
```
