# Сквозной логистический процесс (от заказа до получения)

## 1. Создание заказа пользователем

**Реальность**
Пользователь выбирает товары (SKU), адрес доставки, видит цену и тип доставки. Логистика делает прогнозы.

**Данные (`im` — initialMetrics)**

- `im.ch` — канал, выбранный при продаже
- `im.rev.price` — стоимость логистики для пользователя (тугрики)
- `im.w` — предсказанный вес логистического заказа (кг)
- `im.st` — тип доставки (RM / SRM / NRM)
- `im.t` — время создания логистического заказа

## 2. Формирование логистического заказа

**Реальность**
SKU объединяются продавцом в логистические заказы (seller-level). Это ещё не посылка.

**Данные**

- `_id.o` — order_number (логистический заказ)
- `its[]` — состав заказа:
  - `externalId` — SKU
  - `qty` — количество
  - `uw` — предсказанный вес товара
  - `dangerousKinds` — ограничения на перевозку

## 3. Прибытие заказов на склад

**Реальность**
Логистические заказы физически приезжают на склад. Происходит взвешивание.

**Данные (`fm` — finalMetrics)**

- `fm.w` — измеренный вес логистического заказа (кг)
- `fm.t` — время поступления на склад

## 4. Консолидация заказов в посылки

**Реальность**
Заказы одного пользователя, находящиеся на складе одновременно, могут быть объединены в одну посылку.

**Данные**

- `fm.pid` — parcelId после консолидации (несколько `_id.o` -> один `fm.pid`)
- `fm.pw` — вес посылки (сумма весов заказов + упаковка)

## 5. Финальный выбор логистического канала

**Реальность**
После консолидации система выбирает реальный канал доставки с учётом веса, ограничений и цен партнёров.

**Данные (`fm`)**

- `fm.ch` — финальный логистический канал
- `fm.rev.price` — стоимость логистики для маркетплейса (тугрики)
- `fm.st` — финальный тип доставки (RM / SRM / NRM)

## 6. Международная доставка

**Реальность**
Посылка едет по выбранному каналу (например CN → RU) с заданным уровнем трекинга.

**Данные (прокси)**

- `fm.ch` — косвенно скорость и надёжность
- `fm.st` — качество отслеживания

## 7. Последняя миля и получение

**Реальность**
Доставка в город получателя и вручение.

**Данные**

- `rcv.city`, `rcv.zipCode`, `rcv.countryCode` — адрес доставки

## Где применяется эксперимент с отключением DPX

Модель пересчитывает **шаг 5*- (финальный выбор канала) при фиксированном спросе и консолидации.

Сравниваются два мира:

- `russia-12-25-baseline-v2` — DPX доступен
- `russia-12-25-tariff-change-no-dpx-v4` — DPX недоступен

Цель анализа — понять, как меняются:

- стоимость логистики
- распределение каналов
- эффекты консолидации и веса
